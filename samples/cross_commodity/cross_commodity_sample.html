

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cross commodity portfolios &mdash; EAO  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Combined Heat and Power" href="../combined_heat_power/chp_sample.html" />
    <link rel="prev" title="Marginal costs - basic concept and example" href="../marginal_costs/marginal_costs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            EAO
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../eao.html">EAO package</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../samples.html">Samples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#simple-start-optimizing-power-consumption-with-battery-pv">Simple start: Optimizing power consumption with battery &amp; PV</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#green-ppa-and-structured-downstream-contract">Green PPA and structured downstream contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#marginal-costs-in-portfolio-optimization">Marginal costs in portfolio optimization</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../samples.html#multi-commodity-optimization">Multi commodity optimization</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Cross commodity portfolios</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Some-prerequisites">Some prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Basics">Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Define-the-nodes-for-heat-and-power">Define the nodes for heat and power</a></li>
<li class="toctree-l4"><a class="reference internal" href="#The-overall-portfolio">The overall portfolio</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Perform-the-optimization">Perform the optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Create-charts-and-interpret-the-results">Create charts and interpret the results</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Interpretation">Interpretation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#combined-heat-and-power">Combined Heat and Power</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#battery-optimization-against-an-order-book">Battery optimization against an order book</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#stochastic-linear-programs">Stochastic Linear Programs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#robust-optimization">Robust optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#split-optimization">Split optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#parameter-handling">Parameter handling</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EAO</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../samples.html">Samples</a></li>
      <li class="breadcrumb-item active">Cross commodity portfolios</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/samples/cross_commodity/cross_commodity_sample.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Cross-commodity-portfolios">
<h1>Cross commodity portfolios<a class="headerlink" href="#Cross-commodity-portfolios" title="Link to this heading"></a></h1>
<p>In this sample we illustrate how to define a portfolio that optimizes across different commodities. Here we take the example of heat and power, where a combined heat and power asset produces heat and power at the same time.</p>
<p>A (local) heat demand is fixed and power can be marketed in the power market. An additional power-to-heat asset enables us to convert power to heat</p>
</section>
<section id="Some-prerequisites">
<h1>Some prerequisites<a class="headerlink" href="#Some-prerequisites" title="Link to this heading"></a></h1>
<section id="Basics">
<h2>Basics<a class="headerlink" href="#Basics" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import pandas as pd
import datetime as dt
from copy import deepcopy
# in case eao is not installed
import  os
import sys
# in case eao is not installed, set path
myDir = os.path.join(os.getcwd(), &#39;../..&#39;)
sys.path.append(myDir)
addDir = os.path.join(os.getcwd(), &#39;../../../..&#39;)
sys.path.append(addDir)

import eaopack as eao

import matplotlib.pyplot as plt
%matplotlib inline
</pre></div>
</div>
</div>
</section>
<section id="Define-the-nodes-for-heat-and-power">
<h2>Define the nodes for heat and power<a class="headerlink" href="#Define-the-nodes-for-heat-and-power" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Nodes. In this example, we need to define a node for power and node for heat, since a node may only be used for one commodity. Accordingly we set different physical units for the nodes</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>unit_power = eao.assets.Unit(volume = &#39;MWh(el)&#39;, flow = &#39;MW(el)&#39;)
node_power = eao.assets.Node(name = &#39;power&#39;, unit = unit_power)
unit_heat  = eao.assets.Unit(volume = &#39;MWh(th)&#39;, flow = &#39;MW(th)&#39;)
node_heat     = eao.assets.Node(name = &#39;heat&#39;, unit = unit_heat)
<br/></pre></div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p>Assets</p></li>
</ol>
<p>In this example we define several assets for illustration:</p>
<ul class="simple">
<li><p>a heat demand with a fixed profile. The heat demand must be met</p></li>
<li><p>a heat storage</p></li>
<li><p>a Combined heat and power (CHP) generator, that simultaneously generates heat and power</p></li>
<li><p>a power-to-heat converter (e.g. heat pump)</p></li>
<li><p>a power market where power may be bought or sold</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span>## create battery
storage = eao.assets.Storage(name       = &#39;heat_storage&#39;,
                            nodes       = node_heat,
                            cap_out     = .5,
                            cap_in      = .5,
                            size        = 3.,
                            start_level = 0.,
                            end_level   = 0.,
                            eff_in      = 0.9,
                            block_size  = &#39;d&#39;)     # optimization for each day independently

power2heat   = eao.assets.MultiCommodityContract(name = &#39;power-2-heat&#39;, min_cap= 0, max_cap = 1, nodes = [node_power, node_heat], factors_commodities=[-1, 2])
power_gen    = eao.assets.MultiCommodityContract(name = &#39;CHP&#39;, extra_costs = 50, min_cap= 0, max_cap=1, nodes = [node_power, node_heat], factors_commodities=[0.8, 2.2])
market       = eao.assets.SimpleContract(name = &#39;power_market&#39;, price=&#39;price&#39;, min_cap= -10, max_cap=10, nodes = node_power)

Start = dt.date(2020,1,1)
End   = dt.date(2020,1,3)
dates = pd.date_range(Start, End, freq = &#39;h&#39;).values

heat_curve = {&#39;start&#39;  : dates,
                &#39;values&#39; : - np.sin(np.linspace(0,3, len(dates)))}
heat_demand  = eao.assets.Contract(name = &#39;heat_demand&#39;,  extra_costs = -20, min_cap= heat_curve, max_cap=heat_curve, nodes = node_heat)
portf        = eao.portfolio.Portfolio([storage, power2heat, power_gen, market, heat_demand])
portf.set_timegrid(eao.assets.Timegrid(Start, End, freq = &#39;h&#39;))
</pre></div>
</div>
</div>
<p>Note that the power-to-heat converter as well as the CHP plant live on both, heat and power, nodes. In our definition of the CHP, one dispatch unit translates to 0.8 MWh(el) and 2.2 MWh(th). If the CHP burns gas, we could easily add gas as the third commodity to link all markets</p>
</section>
<section id="The-overall-portfolio">
<h2>The overall portfolio<a class="headerlink" href="#The-overall-portfolio" title="Link to this heading"></a></h2>
<p>The below network chart shows the setup of the portfolio. Note how our assets link both markets / commodities</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>eao.network_graphs.create_graph(portf = portf, title = &#39;Simple portfolio example&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/samples_cross_commodity_cross_commodity_sample_9_0.png" src="../../_images/samples_cross_commodity_cross_commodity_sample_9_0.png" />
</div>
</div>
</section>
</section>
<section id="Perform-the-optimization">
<h1>Perform the optimization<a class="headerlink" href="#Perform-the-optimization" title="Link to this heading"></a></h1>
<p>Let’s load some illustrative power price data and perform the optimization</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>prices = pd.read_csv(&#39;2020_price_sample.csv&#39;)
# cast to timegrid (in this case not necessary, but may be if input granularity does not correspond to timegrid in optimization)
prices = {&#39;price&#39;: portf.timegrid.values_to_grid({&#39;start&#39;: pd.to_datetime(prices[&#39;start&#39;].values), &#39;values&#39;: prices[&#39;price&#39;].values})}
op     = portf.setup_optim_problem(prices)
res    = op.optimize()
out    = eao.io.extract_output(portf, op, res, prices)
</pre></div>
</div>
</div>
</section>
<section id="Create-charts-and-interpret-the-results">
<h1>Create charts and interpret the results<a class="headerlink" href="#Create-charts-and-interpret-the-results" title="Link to this heading"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>allcols = out[&#39;dispatch&#39;].columns.values
heat = []
power = []
for mycol in allcols:
    if &#39;(heat)&#39; in mycol:
        heat.append(mycol)
    else:
        power.append(mycol)
fig, ax = plt.subplots(1,3, tight_layout = True, figsize=(12,4))
out[&#39;dispatch&#39;][heat].plot(ax = ax[0], style = &#39;-&#39;)
out[&#39;dispatch&#39;][power].plot(ax = ax[1], style = &#39;-&#39;)
out[&#39;prices&#39;][&#39;input price: price&#39;].plot(ax = ax[2], style = &#39;-&#39;)
ax[0].set_title(&#39;heat&#39;)
ax[1].set_title(&#39;power&#39;)
ax[2].set_title(&#39;power price&#39;)
plt.show()
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/samples_cross_commodity_cross_commodity_sample_13_0.png" src="../../_images/samples_cross_commodity_cross_commodity_sample_13_0.png" />
</div>
</div>
<section id="Interpretation">
<h2>Interpretation<a class="headerlink" href="#Interpretation" title="Link to this heading"></a></h2>
<p>Heat demand must be met in all times. Depending on prices, either CHP or power-2-heat will be utilized to meet heat demand. The heat storage is utilized to arbitrage between the best hours (mainly with regards to prices on the power market)</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../marginal_costs/marginal_costs.html" class="btn btn-neutral float-left" title="Marginal costs - basic concept and example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../combined_heat_power/chp_sample.html" class="btn btn-neutral float-right" title="Combined Heat and Power" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>