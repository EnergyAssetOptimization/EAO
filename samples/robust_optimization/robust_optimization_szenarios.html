<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Robust optimization - example with szenario analysis &mdash; EAO  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Split Optimization" href="../split_optimization/split_optimization.html" />
    <link rel="prev" title="Stochastic linear program (SLP) to take into account uncertainty" href="../stochastic_optimization/slp_sample.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            EAO
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../eao.html">EAO package</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../samples.html">Samples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#green-ppa-and-structured-downstream-contract">Green PPA and structured downstream contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#marginal-costs-in-portfolio-optimization">Marginal costs in portfolio optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#multi-commodity-optimization">Multi commodity optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#combined-heat-and-power">Combined Heat and Power</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#efficient-optimization-across-different-time-scales">Efficient optimization across different time scales</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#stochastic-linear-programs">Stochastic Linear Programs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../samples.html#robust-optimization">Robust optimization</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Robust optimization - example with szenario analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Some-prerequisites">Some prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Load-data-from-JSON">Load data from JSON</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Define-price-samples">Define price samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Running-the-optimization">Running the optimization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#(1)-deterministic-optimization-on-the-mean-price">(1) deterministic optimization on the mean price</a></li>
<li class="toctree-l4"><a class="reference internal" href="#(2)-robust-optimization-on-the-whole-set-of-prices">(2) robust optimization on the whole set of prices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Analysis">Analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Portfolio-value">Portfolio value</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Detailed-view">Detailed view</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#split-optimization">Split optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../samples.html#parameter-handling">Parameter handling</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EAO</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../samples.html">Samples</a></li>
      <li class="breadcrumb-item active">Robust optimization - example with szenario analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/samples/robust_optimization/robust_optimization_szenarios.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Robust-optimization---example-with-szenario-analysis">
<h1>Robust optimization - example with szenario analysis<a class="headerlink" href="#Robust-optimization---example-with-szenario-analysis" title="Permalink to this heading"></a></h1>
<p>In the standard case, the optimization takes all information (such as prices) for granted and finds the optimum that maximizes the DCF. In reality, particularly prices are uncertain. One way to take into account uncertainty is to minimize risk and maximize the minimum portfolio performance.</p>
<p>In this sample we demonstrate robust optimization for a simple portfolio with a storage as the main asset – where we have a small set of different szenarios. Those szenarios do not necessarily come from a distribution, they would more likely reflect distinct szenarios of a future development (e.g. a regulation is put in place vs. is not put in place).</p>
<p>Note: This optimization approach assumes the asset cannot be re-optimized e.g. once new information during the time frame optimized is available.</p>
</section>
<section id="Some-prerequisites">
<h1>Some prerequisites<a class="headerlink" href="#Some-prerequisites" title="Permalink to this heading"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="c1"># in case eao is not installed, set path</span>
<span class="n">myDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">myDir</span><span class="p">,</span> <span class="s1">&#39;../..&#39;</span><span class="p">))</span>
<span class="n">addDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;../../../..&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addDir</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">eaopack</span> <span class="k">as</span> <span class="nn">eao</span>
</pre></div>
</div>
</div>
<section id="Load-data-from-JSON">
<h2>Load data from JSON<a class="headerlink" href="#Load-data-from-JSON" title="Permalink to this heading"></a></h2>
<p>For simplicity we use a predefined (simple) portfolio. Note that eao provides a simple (de-)serialization from and to JSON files. This allows you to define and store simgle assets or portfolios</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define file names for this sample</span>
<span class="c1">## input data</span>
<span class="n">sample_file</span>   <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">myDir</span><span class="p">,</span> <span class="s1">&#39;portfolio_robust_optimization.json&#39;</span><span class="p">)</span>
<span class="n">timegrid_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">myDir</span><span class="p">,</span> <span class="s1">&#39;timegrid.json&#39;</span><span class="p">)</span>

<span class="n">portf</span> <span class="o">=</span> <span class="n">eao</span><span class="o">.</span><span class="n">serialization</span><span class="o">.</span><span class="n">load_from_json</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span> <span class="n">sample_file</span><span class="p">)</span>
<span class="n">timegrid</span> <span class="o">=</span> <span class="n">eao</span><span class="o">.</span><span class="n">serialization</span><span class="o">.</span><span class="n">load_from_json</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">timegrid_file</span><span class="p">)</span>
<span class="n">eao</span><span class="o">.</span><span class="n">network_graphs</span><span class="o">.</span><span class="n">create_graph</span><span class="p">(</span><span class="n">portf</span> <span class="o">=</span> <span class="n">portf</span><span class="p">,</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Simple sample portfolio&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/samples_robust_optimization_robust_optimization_szenarios_4_0.svg" src="../../_images/samples_robust_optimization_robust_optimization_szenarios_4_0.svg" /></div>
</div>
</section>
</section>
<section id="Define-price-samples">
<h1>Define price samples<a class="headerlink" href="#Define-price-samples" title="Permalink to this heading"></a></h1>
<p>Each contract comes with its own price. In this example we keep two price series fixed (for fix price sales contracts) and sample the floating price (sourcing). Note that the storage is the main element that requires robust optimization. In a deterministic case, it is steered hard to a specific price vector. In the robust case it takes into account prices are uncertain.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price_samples</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># szenario 1</span>
<span class="n">ts</span> <span class="o">=</span> <span class="mi">5</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">15.</span><span class="p">,</span> <span class="n">timegrid</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<span class="n">price_samples</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">ts</span><span class="p">})</span>
<span class="c1"># szenario 2</span>
<span class="n">ts</span> <span class="o">=</span> <span class="mi">5</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">3.</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">15.</span><span class="p">,</span> <span class="n">timegrid</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<span class="n">price_samples</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">ts</span><span class="p">})</span>
<span class="c1"># szenario 3</span>
<span class="n">ts</span> <span class="o">=</span> <span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">12.</span><span class="p">,</span> <span class="n">timegrid</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<span class="n">price_samples</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">ts</span><span class="p">})</span>
<span class="c1"># mean price - to provide an alternative optimization target</span>
<span class="n">mean_prices</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">myp</span> <span class="ow">in</span> <span class="n">price_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ps</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">price_samples</span><span class="p">):</span>
        <span class="n">ts</span> <span class="o">+=</span> <span class="n">ps</span><span class="p">[</span><span class="n">myp</span><span class="p">]</span>
    <span class="n">ts</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">price_samples</span><span class="p">)</span>
    <span class="n">mean_prices</span><span class="p">[</span><span class="n">myp</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>
</pre></div>
</div>
</div>
</section>
<section id="Running-the-optimization">
<h1>Running the optimization<a class="headerlink" href="#Running-the-optimization" title="Permalink to this heading"></a></h1>
<section id="(1)-deterministic-optimization-on-the-mean-price">
<h2>(1) deterministic optimization on the mean price<a class="headerlink" href="#(1)-deterministic-optimization-on-the-mean-price" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">op_mean</span>  <span class="o">=</span> <span class="n">portf</span><span class="o">.</span><span class="n">setup_optim_problem</span><span class="p">(</span><span class="n">mean_prices</span><span class="p">,</span> <span class="n">timegrid</span><span class="p">)</span>
<span class="n">res_mean</span> <span class="o">=</span> <span class="n">op_mean</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="(2)-robust-optimization-on-the-whole-set-of-prices">
<h2>(2) robust optimization on the whole set of prices<a class="headerlink" href="#(2)-robust-optimization-on-the-whole-set-of-prices" title="Permalink to this heading"></a></h2>
<p>In the implementation we re-use the optimization problem with all its restrictions and add the samples. For this purpose, the price samples need to be translated to specific cost arrays for each asset in the portfolio.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cost_samples</span> <span class="o">=</span> <span class="n">portf</span><span class="o">.</span><span class="n">create_cost_samples</span><span class="p">(</span><span class="n">price_samples</span> <span class="o">=</span> <span class="n">price_samples</span><span class="p">,</span> <span class="n">timegrid</span> <span class="o">=</span> <span class="n">timegrid</span><span class="p">)</span>
<span class="n">res_robust</span>  <span class="o">=</span> <span class="n">op_mean</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;robust&#39;</span><span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">cost_samples</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="Analysis">
<h1>Analysis<a class="headerlink" href="#Analysis" title="Permalink to this heading"></a></h1>
<section id="Portfolio-value">
<h2>Portfolio value<a class="headerlink" href="#Portfolio-value" title="Permalink to this heading"></a></h2>
<p>Looking at the plain portfolio value, it is not surprising, that the robust optimization achieves less value on the mean price, than the optimization that is optimized directly on the mean</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Portfolio value against mean prices:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;... optimized against mean: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:10.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res_mean</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;... robust optimization   : &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:10.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res_robust</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Portfolio value against mean prices:
... optimized against mean:      359.2
... robust optimization   :      118.3
</pre></div></div>
</div>
<p>Now let us look at the performance of the optimized portfolios against price samples.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">values_mean</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">price_samples</span><span class="p">))</span>
<span class="n">values_robust</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">price_samples</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">myc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cost_samples</span><span class="p">):</span>
    <span class="n">values_mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">res_mean</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">myc</span><span class="p">)</span>
    <span class="n">values_robust</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">res_robust</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">myc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minimum portfolio value on original samples:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;... optimized against mean: &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:10.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">values_mean</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;... robust optimization   : &#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:10.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">values_robust</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Minimum portfolio value on original samples:
... optimized against mean:    -2018.6
... robust optimization   :      118.3
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">n_bins</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tight_layout</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Results on training samples&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">values_mean</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">n_bins</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">values_robust</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">n_bins</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;portfolio value&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;sample frequency&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;optimized against mean&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;robust optimization&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">values_mean</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">values_robust</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">values_mean</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">values_robust</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/samples_robust_optimization_robust_optimization_szenarios_16_0.svg" src="../../_images/samples_robust_optimization_robust_optimization_szenarios_16_0.svg" /></div>
</div>
</section>
<section id="Detailed-view">
<h2>Detailed view<a class="headerlink" href="#Detailed-view" title="Permalink to this heading"></a></h2>
<p>Let us look at prices and the dispatch</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out_mean</span>   <span class="o">=</span> <span class="n">eao</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">extract_output</span><span class="p">(</span><span class="n">portf</span><span class="p">,</span> <span class="n">op_mean</span><span class="p">,</span> <span class="n">res_mean</span> <span class="p">,</span> <span class="n">mean_prices</span><span class="p">)</span>
<span class="n">out_robust</span> <span class="o">=</span> <span class="n">eao</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">extract_output</span><span class="p">(</span><span class="n">portf</span><span class="p">,</span> <span class="n">op_mean</span><span class="p">,</span> <span class="n">res_robust</span> <span class="p">,</span> <span class="n">mean_prices</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">tight_layout</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Asset dispatch and prices&#39;</span><span class="p">)</span>
<span class="c1"># add price info to dispatches</span>
<span class="n">out_mean</span><span class="p">[</span><span class="s1">&#39;dispatch&#39;</span><span class="p">][</span><span class="s1">&#39;mean price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_prices</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<span class="n">out_robust</span><span class="p">[</span><span class="s1">&#39;dispatch&#39;</span><span class="p">][</span><span class="s1">&#39;mean price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_prices</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<span class="n">out_robust</span><span class="p">[</span><span class="s1">&#39;dispatch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;market&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">out_mean</span><span class="p">[</span><span class="s1">&#39;dispatch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;market&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ps</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">price_samples</span><span class="p">):</span>
    <span class="n">out_robust</span><span class="p">[</span><span class="s1">&#39;dispatch&#39;</span><span class="p">][</span><span class="s1">&#39;sample &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
    <span class="n">out_mean</span><span class="p">[</span><span class="s1">&#39;dispatch&#39;</span><span class="p">][</span><span class="s1">&#39;sample &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
<span class="n">out_mean</span><span class="p">[</span><span class="s1">&#39;dispatch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">out_robust</span><span class="p">[</span><span class="s1">&#39;dispatch&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;optimized against mean&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;robust optimization&#39;</span><span class="p">)</span>
<span class="c1">#ax[0].axis(&#39;off&#39;)</span>
<span class="c1">#ax[1].axis(&#39;off&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/samples_robust_optimization_robust_optimization_szenarios_19_0.svg" src="../../_images/samples_robust_optimization_robust_optimization_szenarios_19_0.svg" /></div>
</div>
<p>This illustrates the approach (being a very simple example): The dispatch optimized against the mean exploits ups and downs in the mean of prices. However, due to the design of the szenarios, this optimum may prove a very bad fit for some szenarios. The robust optimization maximizes against all single szenarios jointly using a MaxiMin target.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../stochastic_optimization/slp_sample.html" class="btn btn-neutral float-left" title="Stochastic linear program (SLP) to take into account uncertainty" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../split_optimization/split_optimization.html" class="btn btn-neutral float-right" title="Split Optimization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>